<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RÃ¨dÃ¨ â€” Assistant IA</title>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME VARIABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --transition: 0.25s ease;
}

[data-theme="dark"] {
  --bg:        #0c0e14;
  --bg2:       #12151e;
  --bg3:       #1a1e2a;
  --surface:   #1f2333;
  --surface2:  #262b3d;
  --border:    rgba(255,255,255,0.07);
  --border2:   rgba(255,255,255,0.12);
  --text:      #e2e4ed;
  --text2:     #7c82a0;
  --text3:     #4a5070;
  --accent:    #4f8ef7;
  --accent2:   #7eb3ff;
  --accentBg:  rgba(79,142,247,0.12);
  --user-bg:   #1e2d52;
  --user-bd:   rgba(79,142,247,0.25);
  --bot-bg:    #1a1e2a;
  --bot-bd:    rgba(255,255,255,0.06);
  --danger:    #f87171;
  --success:   #34d399;
  --shadow:    0 8px 32px rgba(0,0,0,0.4);
  --glow:      0 0 40px rgba(79,142,247,0.08);
}

[data-theme="light"] {
  --bg:        #f5f6fa;
  --bg2:       #edeef5;
  --bg3:       #e4e6f0;
  --surface:   #ffffff;
  --surface2:  #f0f2f9;
  --border:    rgba(0,0,0,0.07);
  --border2:   rgba(0,0,0,0.13);
  --text:      #1a1d2e;
  --text2:     #6b6f8a;
  --text3:     #a0a4be;
  --accent:    #2563eb;
  --accent2:   #1d4ed8;
  --accentBg:  rgba(37,99,235,0.08);
  --user-bg:   #dbeafe;
  --user-bd:   rgba(37,99,235,0.2);
  --bot-bg:    #ffffff;
  --bot-bd:    rgba(0,0,0,0.07);
  --danger:    #dc2626;
  --success:   #16a34a;
  --shadow:    0 4px 24px rgba(0,0,0,0.08);
  --glow:      0 0 40px rgba(37,99,235,0.04);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

html { color-scheme: dark; }
[data-theme="light"] { color-scheme: light; }

body {
  font-family: 'Bricolage Grotesque', sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100dvh;
  overflow: hidden;
  transition: background var(--transition), color var(--transition);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen { position:fixed; inset:0; display:none; z-index:1; }
.screen.active { display:flex; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#auth-screen {
  align-items: center;
  justify-content: center;
  padding: 20px;
  background: var(--bg);
}

/* Decorative grid */
#auth-screen::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(var(--border) 1px, transparent 1px),
    linear-gradient(90deg, var(--border) 1px, transparent 1px);
  background-size: 48px 48px;
  pointer-events: none;
  mask-image: radial-gradient(ellipse 70% 70% at 50% 50%, black, transparent);
}

#auth-screen::after {
  content: '';
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 600px; height: 600px;
  background: radial-gradient(circle, var(--accentBg) 0%, transparent 65%);
  pointer-events: none;
}

.auth-container {
  width: 100%;
  max-width: 420px;
  position: relative;
  z-index: 2;
  animation: authIn 0.5s cubic-bezier(0.16,1,0.3,1);
}

@keyframes authIn {
  from { opacity:0; transform:translateY(24px) scale(0.98); }
  to   { opacity:1; transform:translateY(0) scale(1); }
}

/* Theme toggle on auth */
.auth-theme-toggle {
  position: absolute;
  top: -48px; right: 0;
}

/* Brand */
.auth-brand {
  text-align: center;
  margin-bottom: 28px;
}

.brand-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 56px; height: 56px;
  background: var(--accent);
  border-radius: 16px;
  margin-bottom: 14px;
  box-shadow: 0 0 0 8px var(--accentBg), var(--shadow);
  position: relative;
}

.brand-icon svg { color: white; }

.auth-brand h1 {
  font-size: 26px;
  font-weight: 700;
  letter-spacing: -0.5px;
  color: var(--text);
}

.auth-brand p {
  font-size: 14px;
  color: var(--text2);
  margin-top: 5px;
  font-weight: 300;
}

/* Card */
.auth-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 20px;
  padding: 32px;
  box-shadow: var(--shadow), var(--glow);
  transition: background var(--transition), border-color var(--transition);
}

/* Tabs */
.tabs {
  display: flex;
  background: var(--bg2);
  border-radius: 10px;
  padding: 3px;
  gap: 3px;
  margin-bottom: 24px;
  transition: background var(--transition);
}

.tab {
  flex: 1;
  padding: 9px;
  border: none;
  background: transparent;
  color: var(--text2);
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 14px;
  font-weight: 500;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.tab.active {
  background: var(--surface);
  color: var(--text);
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}

/* Form */
.form-group { margin-bottom: 14px; }

.form-group label {
  display: block;
  font-size: 11.5px;
  font-weight: 600;
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 0.7px;
  margin-bottom: 6px;
  transition: color var(--transition);
}

.form-group input {
  width: 100%;
  padding: 11px 14px;
  background: var(--bg2);
  border: 1.5px solid var(--border2);
  border-radius: 10px;
  color: var(--text);
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 14.5px;
  outline: none;
  transition: all 0.2s;
}

.form-group input::placeholder { color: var(--text3); }

.form-group input:focus {
  border-color: var(--accent);
  background: var(--surface);
  box-shadow: 0 0 0 3px var(--accentBg);
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.btn-primary {
  width: 100%;
  padding: 13px;
  background: var(--accent);
  border: none;
  border-radius: 11px;
  color: white;
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 6px;
  letter-spacing: 0.2px;
}

.btn-primary:hover {
  filter: brightness(1.1);
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(79,142,247,0.3);
}

.btn-primary:active { transform: translateY(0); }
.btn-primary:disabled { opacity:0.45; cursor:not-allowed; transform:none; box-shadow:none; filter:none; }

.form-alert {
  display: none;
  margin-top: 12px;
  padding: 10px 13px;
  border-radius: 9px;
  font-size: 13px;
  text-align: center;
}

.form-alert.error  { display:block; background:rgba(248,113,113,0.1); border:1px solid rgba(248,113,113,0.25); color:var(--danger); }
.form-alert.success { display:block; background:rgba(52,211,153,0.1); border:1px solid rgba(52,211,153,0.25); color:var(--success); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHAT SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#chat-screen {
  flex-direction: column;
  background: var(--bg);
}

/* Header */
.chat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  height: 60px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
  transition: background var(--transition), border-color var(--transition);
}

.hd-left { display:flex; align-items:center; gap:11px; }

.hd-icon {
  width: 34px; height: 34px;
  background: var(--accent);
  border-radius: 9px;
  display: flex; align-items:center; justify-content:center;
}

.hd-icon svg { color:white; }

.hd-title {
  font-size: 16px;
  font-weight: 700;
  letter-spacing: -0.3px;
  color: var(--text);
}

.hd-status {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 11.5px;
  color: var(--text2);
  margin-top: 1px;
  font-weight: 400;
}

.status-dot {
  width: 6px; height: 6px;
  background: var(--success);
  border-radius: 50%;
  animation: pulse 2.5s infinite;
}

@keyframes pulse {
  0%,100% { box-shadow: 0 0 0 0 rgba(52,211,153,0.5); }
  50%      { box-shadow: 0 0 0 4px rgba(52,211,153,0); }
}

.hd-right { display:flex; align-items:center; gap:8px; }

.user-chip {
  display: flex;
  align-items: center;
  gap: 7px;
  padding: 5px 11px 5px 5px;
  background: var(--bg2);
  border: 1px solid var(--border2);
  border-radius: 20px;
  transition: background var(--transition);
}

.user-av {
  width: 24px; height: 24px;
  background: var(--accent);
  border-radius: 50%;
  display: flex; align-items:center; justify-content:center;
  font-size: 11px; font-weight: 700;
  color: white;
  font-family: 'Fira Code', monospace;
}

.user-chip span {
  font-size: 13px;
  font-weight: 500;
  color: var(--text);
}

/* Icon Buttons */
.icon-btn {
  width: 32px; height: 32px;
  display: flex; align-items:center; justify-content:center;
  background: var(--bg2);
  border: 1px solid var(--border2);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  color: var(--text2);
}

.icon-btn:hover { background:var(--surface2); color:var(--text); }

.icon-btn.danger:hover {
  background: rgba(248,113,113,0.1);
  border-color: rgba(248,113,113,0.3);
  color: var(--danger);
}

/* Messages */
#messages {
  flex: 1;
  overflow-y: auto;
  padding: 24px 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  scroll-behavior: smooth;
}

#messages::-webkit-scrollbar { width: 4px; }
#messages::-webkit-scrollbar-track { background: transparent; }
#messages::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 6px; }

/* Welcome */
.welcome {
  text-align: center;
  padding: 20px 0 8px;
}

.welcome-time {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 500;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 4px 12px;
  margin-bottom: 12px;
  font-family: 'Fira Code', monospace;
}

.welcome h2 {
  font-size: 18px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
}

.welcome p { font-size: 13.5px; color: var(--text2); font-weight: 300; }

/* Message rows */
.msg-row {
  display: flex;
  gap: 10px;
  align-items: flex-start;
  animation: msgIn 0.28s cubic-bezier(0.16,1,0.3,1);
}

@keyframes msgIn {
  from { opacity:0; transform:translateY(8px); }
  to   { opacity:1; transform:translateY(0); }
}

.msg-row.user { flex-direction: row-reverse; }

.msg-av {
  width: 30px; height: 30px;
  border-radius: 8px;
  flex-shrink: 0;
  display: flex; align-items:center; justify-content:center;
  font-size: 12px; font-weight: 700;
  margin-top: 2px;
  font-family: 'Fira Code', monospace;
  transition: background var(--transition);
}

.msg-av.bot { background:var(--accent); color:white; }
.msg-av.me  { background:var(--surface2); color:var(--accent); border:1px solid var(--border2); }

.msg-body { max-width: min(520px, 74vw); }

.msg-meta {
  font-size: 11px;
  font-weight: 600;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
  font-family: 'Fira Code', monospace;
}

.msg-row.user .msg-meta { text-align: right; }

.msg-bubble {
  padding: 11px 15px;
  border-radius: 12px;
  font-size: 14.5px;
  line-height: 1.65;
  transition: background var(--transition), border-color var(--transition);
}

.msg-bubble.bot {
  background: var(--bot-bg);
  border: 1px solid var(--bot-bd);
  color: var(--text);
  border-radius: 4px 12px 12px 12px;
}

.msg-bubble.user {
  background: var(--user-bg);
  border: 1px solid var(--user-bd);
  color: var(--text);
  border-radius: 12px 4px 12px 12px;
}

/* Typing */
.typing-wrap { display:flex; gap:5px; padding:3px 2px; }
.typing-wrap span {
  width: 7px; height: 7px;
  background: var(--text3);
  border-radius: 50%;
  animation: tdot 1.4s infinite;
}
.typing-wrap span:nth-child(2) { animation-delay:0.2s; }
.typing-wrap span:nth-child(3) { animation-delay:0.4s; }

@keyframes tdot {
  0%,60%,100% { transform:translateY(0); opacity:0.4; }
  30%          { transform:translateY(-5px); opacity:1; }
}

/* Input area */
.chat-input {
  padding: 14px 20px 18px;
  background: var(--surface);
  border-top: 1px solid var(--border);
  flex-shrink: 0;
  transition: background var(--transition), border-color var(--transition);
}

.chips {
  display: flex;
  gap: 7px;
  margin-bottom: 11px;
  overflow-x: auto;
  scrollbar-width: none;
}
.chips::-webkit-scrollbar { display:none; }

.chip {
  padding: 5px 13px;
  background: var(--bg2);
  border: 1px solid var(--border2);
  border-radius: 20px;
  font-size: 12.5px;
  color: var(--text2);
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s;
  font-family: 'Bricolage Grotesque', sans-serif;
  font-weight: 500;
}

.chip:hover {
  background: var(--accentBg);
  border-color: var(--accent);
  color: var(--accent2);
}

.input-row {
  display: flex;
  gap: 9px;
  align-items: flex-end;
}

#msg-input {
  flex: 1;
  padding: 12px 16px;
  background: var(--bg2);
  border: 1.5px solid var(--border2);
  border-radius: 12px;
  color: var(--text);
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 14.5px;
  outline: none;
  resize: none;
  max-height: 120px;
  line-height: 1.5;
  transition: all 0.2s;
}

#msg-input::placeholder { color: var(--text3); }
#msg-input:focus {
  border-color: var(--accent);
  background: var(--surface2);
  box-shadow: 0 0 0 3px var(--accentBg);
}

#send-btn {
  width: 46px; height: 46px;
  background: var(--accent);
  border: none;
  border-radius: 12px;
  cursor: pointer;
  display: flex; align-items:center; justify-content:center;
  transition: all 0.2s;
  flex-shrink: 0;
  color: white;
}

#send-btn:hover {
  filter: brightness(1.1);
  transform: translateY(-1px);
  box-shadow: 0 6px 18px rgba(79,142,247,0.35);
}

#send-btn:active { transform:translateY(0); }
#send-btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; filter:none; }

.input-hint {
  text-align: center;
  font-size: 11px;
  color: var(--text3);
  margin-top: 9px;
  font-family: 'Fira Code', monospace;
}

.input-hint kbd {
  background: var(--bg3);
  border: 1px solid var(--border2);
  border-radius: 4px;
  padding: 1px 5px;
  font-family: 'Fira Code', monospace;
  font-size: 10px;
  color: var(--text2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME TOGGLE BUTTON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.theme-toggle {
  width: 32px; height: 32px;
  display: flex; align-items:center; justify-content:center;
  background: var(--bg2);
  border: 1px solid var(--border2);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  color: var(--text2);
  position: relative;
  overflow: hidden;
}

.theme-toggle:hover { background:var(--surface2); color:var(--text); }

.theme-toggle .sun  { position:absolute; transition: all 0.3s; }
.theme-toggle .moon { position:absolute; transition: all 0.3s; }

[data-theme="dark"]  .sun  { opacity:1; transform:scale(1); }
[data-theme="dark"]  .moon { opacity:0; transform:scale(0.5) rotate(90deg); }
[data-theme="light"] .sun  { opacity:0; transform:scale(0.5) rotate(-90deg); }
[data-theme="light"] .moon { opacity:1; transform:scale(1); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPINNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.spin {
  width: 15px; height: 15px;
  border: 2px solid rgba(255,255,255,0.25);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.65s linear infinite;
  display: inline-block;
}
@keyframes spin { to { transform:rotate(360deg); } }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â• AUTH â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="auth-screen">
  <div class="auth-container">

    <!-- Theme toggle -->
    <div class="auth-theme-toggle">
      <button class="theme-toggle" onclick="toggleTheme()" title="Changer le thÃ¨me">
        <svg class="sun" width="15" height="15" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"/><path stroke-linecap="round" stroke-width="2" d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <svg class="moon" width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/>
        </svg>
      </button>
    </div>

    <!-- Brand -->
    <div class="auth-brand">
      <div class="brand-icon">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
        </svg>
      </div>
      <h1>RÃ¨dÃ¨ ChatBot</h1>
      <p>Votre assistant intelligent propulsÃ© par l'IA</p>
    </div>

    <!-- Card -->
    <div class="auth-card">
      <div class="tabs">
        <button class="tab active" id="tab-login" onclick="switchTab('login')">Connexion</button>
        <button class="tab" id="tab-register" onclick="switchTab('register')">Inscription</button>
      </div>

      <!-- LOGIN â€” username + password -->
      <div id="form-login">
        <div class="form-group">
          <label>Nom d'utilisateur</label>
          <input type="text" id="l-username" placeholder="david123" autocomplete="username" />
        </div>
        <div class="form-group">
          <label>Mot de passe</label>
          <input type="password" id="l-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />
        </div>
        <button class="btn-primary" id="login-btn" onclick="doLogin()">Se connecter</button>
        <div class="form-alert" id="login-alert"></div>
      </div>

      <!-- REGISTER â€” username, nom, prenom, email, password -->
      <div id="form-register" style="display:none">
        <div class="form-group">
          <label>Nom d'utilisateur</label>
          <input type="text" id="r-username" placeholder="david123" autocomplete="username" />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Nom</label>
            <input type="text" id="r-nom" placeholder="Dupont" />
          </div>
          <div class="form-group">
            <label>PrÃ©nom</label>
            <input type="text" id="r-prenom" placeholder="David" />
          </div>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="r-email" placeholder="vous@exemple.com" autocomplete="email" />
        </div>
        <div class="form-group">
          <label>Mot de passe <span style="color:var(--text3);font-weight:400;font-size:10px;">(min. 6 car.)</span></label>
          <input type="password" id="r-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" />
        </div>
        <button class="btn-primary" id="register-btn" onclick="doRegister()">CrÃ©er mon compte</button>
        <div class="form-alert" id="register-alert"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• CHAT â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="chat-screen">

  <!-- Header -->
  <div class="chat-header">
    <div class="hd-left">
      <div class="hd-icon">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
        </svg>
      </div>
      <div>
        <div class="hd-title">RÃ¨dÃ¨</div>
        <div class="hd-status"><div class="status-dot"></div> En ligne</div>
      </div>
    </div>
    <div class="hd-right">
      <div class="user-chip">
        <div class="user-av" id="user-av">D</div>
        <span id="user-name">david</span>
      </div>
      <button class="theme-toggle" onclick="toggleTheme()" title="Changer le thÃ¨me">
        <svg class="sun" width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"/><path stroke-linecap="round" stroke-width="2" d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <svg class="moon" width="13" height="13" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/>
        </svg>
      </button>
      <button class="icon-btn danger" onclick="doLogout()" title="DÃ©connexion">
        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Messages -->
  <div id="messages">
    <div class="welcome">
      <div class="welcome-time" id="welcome-time">â° Chargement...</div>
      <h2>Bonjour, comment puis-je vous aider ?</h2>
      <p>Je suis RÃ¨dÃ¨, votre assistant IA personnel</p>
    </div>
    <div class="msg-row" id="welcome-msg">
      <div class="msg-av bot">AI</div>
      <div class="msg-body">
        <div class="msg-meta">RÃ¨dÃ¨</div>
        <div class="msg-bubble bot">ğŸ‘‹ Bienvenue ! Posez-moi vos questions, je suis lÃ  pour vous aider.</div>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="chat-input">
    <div class="chips">
      <button class="chip" onclick="useChip('Quelles sont tes capacitÃ©s ?')">ğŸ’¡ CapacitÃ©s</button>
      <button class="chip" onclick="useChip('Aide-moi Ã  rÃ©diger un email professionnel')">âœï¸ RÃ©daction</button>
      <button class="chip" onclick="useChip('Explique-moi un concept technique')">ğŸ“š Expliquer</button>
      <button class="chip" onclick="useChip('GÃ©nÃ¨re des idÃ©es crÃ©atives sur un sujet')">ğŸ¨ IdÃ©es</button>
      <button class="chip" onclick="useChip('RÃ©sume ce texte en 3 points clÃ©s')">ğŸ“‹ RÃ©sumÃ©</button>
    </div>
    <div class="input-row">
      <textarea id="msg-input" rows="1" placeholder="Ã‰crivez votre messageâ€¦"></textarea>
      <button id="send-btn" onclick="sendMsg()">
        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
        </svg>
      </button>
    </div>
    <div class="input-hint"><kbd>Enter</kbd> pour envoyer Â· <kbd>Shift+Enter</kbd> pour nouvelle ligne</div>
  </div>
</div>

<script>
const API = 'http://localhost:8000';
let token    = localStorage.getItem('rd_token');
let userId   = parseInt(localStorage.getItem('rd_uid') || '0');
let username = localStorage.getItem('rd_user') || '';

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const savedTheme = localStorage.getItem('rd_theme') || 'dark';
document.documentElement.setAttribute('data-theme', savedTheme);
if (token) openChat();
setWelcomeTime();

function setWelcomeTime() {
  const el = document.getElementById('welcome-time');
  if (!el) return;
  const d = new Date();
  const days = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
  const months = ['jan','fÃ©v','mar','avr','mai','jun','jul','aoÃ»','sep','oct','nov','dÃ©c'];
  el.textContent = `${days[d.getDay()]} ${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
}

// â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleTheme() {
  const cur = document.documentElement.getAttribute('data-theme');
  const next = cur === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('rd_theme', next);
}

// â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(t) {
  document.getElementById('tab-login').classList.toggle('active', t === 'login');
  document.getElementById('tab-register').classList.toggle('active', t === 'register');
  document.getElementById('form-login').style.display = t === 'login' ? 'block' : 'none';
  document.getElementById('form-register').style.display = t === 'register' ? 'block' : 'none';
}

function showAlert(id, msg, type) {
  const el = document.getElementById(id);
  el.textContent = msg;
  el.className = `form-alert ${type}`;
}

// â”€â”€ REGISTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doRegister() {
  const btn = document.getElementById('register-btn');
  const body = {
    username: document.getElementById('r-username').value.trim(),
    nom:      document.getElementById('r-nom').value.trim(),
    prenom:   document.getElementById('r-prenom').value.trim(),
    email:    document.getElementById('r-email').value.trim(),
    password: document.getElementById('r-password').value,
  };

  if (!body.username || !body.nom || !body.prenom || !body.email || !body.password) {
    showAlert('register-alert', 'Veuillez remplir tous les champs.', 'error'); return;
  }
  if (body.password.length < 6) {
    showAlert('register-alert', 'Le mot de passe doit faire au moins 6 caractÃ¨res.', 'error'); return;
  }

  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span>';

  try {
    const res  = await fetch(`${API}/api/auth/register`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (!res.ok) {
      showAlert('register-alert', data.detail || 'Erreur inscription.', 'error');
    } else {
      showAlert('register-alert', 'âœ… Compte crÃ©Ã© ! Connectez-vous.', 'success');
      // prÃ©-remplir le login
      document.getElementById('l-username').value = body.username;
      setTimeout(() => switchTab('login'), 1600);
    }
  } catch {
    showAlert('register-alert', 'âŒ Serveur inaccessible.', 'error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'CrÃ©er mon compte';
  }
}

// â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doLogin() {
  const btn  = document.getElementById('login-btn');
  const uname = document.getElementById('l-username').value.trim();
  const pass  = document.getElementById('l-password').value;

  if (!uname || !pass) {
    showAlert('login-alert', 'Veuillez remplir tous les champs.', 'error'); return;
  }

  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span>';

  try {
    const res  = await fetch(`${API}/api/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username: uname, password: pass })
    });
    const data = await res.json();

    if (!res.ok) {
      showAlert('login-alert', data.detail || 'Identifiants incorrects.', 'error');
    } else {
      token = data.access_token;
      try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        userId = parseInt(payload.sub) || 1;
      } catch { userId = 1; }
      username = uname;
      localStorage.setItem('rd_token', token);
      localStorage.setItem('rd_uid',   userId);
      localStorage.setItem('rd_user',  username);
      openChat();
    }
  } catch {
    showAlert('login-alert', 'âŒ Serveur inaccessible.', 'error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'Se connecter';
  }
}

// â”€â”€ OPEN CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openChat() {
  document.getElementById('auth-screen').classList.remove('active');
  document.getElementById('chat-screen').classList.add('active');
  document.getElementById('user-name').textContent = username;
  document.getElementById('user-av').textContent   = (username[0] || 'U').toUpperCase();
  setWelcomeTime();
  document.getElementById('msg-input').focus();
}

// â”€â”€ LOGOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogout() {
  localStorage.removeItem('rd_token');
  localStorage.removeItem('rd_uid');
  localStorage.removeItem('rd_user');
  token = null; userId = 0; username = '';
  document.getElementById('chat-screen').classList.remove('active');
  document.getElementById('auth-screen').classList.add('active');
  resetMessages();
}

function resetMessages() {
  const box = document.getElementById('messages');
  box.innerHTML = `
    <div class="welcome">
      <div class="welcome-time" id="welcome-time">Aujourd'hui</div>
      <h2>Bonjour, comment puis-je vous aider ?</h2>
      <p>Je suis RÃ¨dÃ¨, votre assistant IA personnel</p>
    </div>
    <div class="msg-row">
      <div class="msg-av bot">AI</div>
      <div class="msg-body">
        <div class="msg-meta">RÃ¨dÃ¨</div>
        <div class="msg-bubble bot">ğŸ‘‹ Bienvenue ! Posez-moi vos questions, je suis lÃ  pour vous aider.</div>
      </div>
    </div>`;
  setWelcomeTime();
}

// â”€â”€ CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function useChip(text) {
  const input = document.getElementById('msg-input');
  input.value = text;
  input.focus();
  resize(input);
}

// â”€â”€ AUTO-RESIZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
}
document.getElementById('msg-input').addEventListener('input', function() { resize(this); });

// â”€â”€ SEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sendMsg() {
  const input = document.getElementById('msg-input');
  const msg   = input.value.trim();
  if (!msg) return;

  addMsg(msg, 'user');
  input.value = '';
  resize(input);

  const tid = addTyping();
  document.getElementById('send-btn').disabled = true;

  try {
    const res  = await fetch(`${API}/api/chat`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({ user_id: userId, message: msg })
    });

    removeTyping(tid);

    if (res.status === 401) { doLogout(); return; }

    const data = await res.json();
    addMsg(data.response || data.detail || 'Erreur inattendue.', 'bot');
  } catch {
    removeTyping(tid);
    addMsg('âŒ Impossible de contacter le serveur.', 'bot');
  } finally {
    document.getElementById('send-btn').disabled = false;
  }
}

// â”€â”€ ADD MESSAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addMsg(text, type) {
  const box  = document.getElementById('messages');
  const row  = document.createElement('div');
  row.className = `msg-row ${type === 'user' ? 'user' : ''}`;

  const av   = document.createElement('div');
  av.className = `msg-av ${type === 'user' ? 'me' : 'bot'}`;
  av.textContent = type === 'user' ? (username[0] || 'U').toUpperCase() : 'AI';

  const body = document.createElement('div');
  body.className = 'msg-body';

  const meta = document.createElement('div');
  meta.className = 'msg-meta';
  meta.textContent = type === 'user' ? username : 'RÃ¨dÃ¨';

  const bubble = document.createElement('div');
  bubble.className = `msg-bubble ${type === 'user' ? 'user' : 'bot'}`;
  bubble.textContent = text;

  body.appendChild(meta);
  body.appendChild(bubble);
  row.appendChild(av);
  row.appendChild(body);
  box.appendChild(row);
  box.scrollTop = box.scrollHeight;
}

// â”€â”€ TYPING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addTyping() {
  const id  = 'ty' + Date.now();
  const box = document.getElementById('messages');
  const row = document.createElement('div');
  row.className = 'msg-row';
  row.id = id;
  row.innerHTML = `
    <div class="msg-av bot">AI</div>
    <div class="msg-body">
      <div class="msg-meta">RÃ¨dÃ¨</div>
      <div class="msg-bubble bot"><div class="typing-wrap"><span></span><span></span><span></span></div></div>
    </div>`;
  box.appendChild(row);
  box.scrollTop = box.scrollHeight;
  return id;
}

function removeTyping(id) {
  const el = document.getElementById(id);
  if (el) el.remove();
}

// â”€â”€ KEYBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('msg-input').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMsg(); }
});

['l-username','l-password'].forEach(id =>
  document.getElementById(id)?.addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); })
);

['r-username','r-nom','r-prenom','r-email','r-password'].forEach(id =>
  document.getElementById(id)?.addEventListener('keydown', e => { if (e.key === 'Enter') doRegister(); })
);
</script>
</body>
</html>